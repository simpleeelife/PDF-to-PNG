# PDF to PNG 変換アプリケーション

## 要件定義書・仕様書

---

# 第1部：要件定義書

## 1. プロジェクト概要

### 1.1 目的
PDFファイルの各ページを高画質なPNG画像に変換するWindowsデスクトップアプリケーションを開発する。

### 1.2 背景
動画制作やプレゼンテーション資料作成において、PDFの各ページを画像として利用するニーズがある。1080p動画での使用に耐えうる品質で、簡単な操作で変換できるツールが求められている。

### 1.3 対象ユーザー
- 動画クリエイター
- プレゼンテーション資料を扱うビジネスユーザー
- 技術的な知識が少ないユーザーでも利用可能

---

## 2. 機能要件

### 2.1 必須機能（Must Have）

| ID | 機能名 | 説明 |
|----|--------|------|
| F-001 | ドラッグ＆ドロップ入力 | PDFファイルをアプリウィンドウにドラッグ＆ドロップで読み込み |
| F-002 | 自動変換開始 | ファイル投入後、自動的に変換処理を開始 |
| F-003 | 全ページ一括変換 | PDFの全ページを個別のPNG画像に変換 |
| F-004 | 高画質出力 | 1080p動画で粗く見えない品質（200 DPI）で出力 |
| F-005 | ファイル命名規則 | 「元ファイル名_ページ番号.png」形式で出力 |
| F-006 | 固定出力先 | 指定された固定フォルダに出力 |
| F-007 | 進捗表示 | 変換中の進捗状況を表示 |
| F-008 | エラー詳細表示 | エラー発生時、詳細な理由を表示 |

### 2.2 対応範囲

| 項目 | 仕様 |
|------|------|
| 対応OS | Windows 10/11 |
| 対応PDFページ数 | 最大30ページ |
| 対応ファイル形式 | PDF（.pdf） |
| 出力形式 | PNG（.png） |

---

## 3. 非機能要件

### 3.1 ユーザビリティ
- インストール不要または簡単なインストール手順
- 起動後すぐに使用可能（設定不要）
- 直感的なUI（ドラッグ＆ドロップのみで操作完結）

### 3.2 パフォーマンス
- 30ページのPDF変換を2分以内に完了
- メモリ使用量500MB以下

### 3.3 信頼性
- 破損したPDFや非対応形式でもアプリがクラッシュしない
- エラー発生時も正常に復帰可能

---

## 4. 制約条件

### 4.1 技術的制約
- 無料のライブラリ・ツールのみ使用
- オフライン環境で動作可能

### 4.2 運用制約
- 商用利用不可のライブラリは使用しない
- ユーザーサポートは提供しない（セルフサービス）

---

## 5. 想定されるリスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| パスワード保護されたPDF | 変換不可 | エラーメッセージで明示 |
| 30ページ超のPDF | 処理時間超過の可能性 | 事前にページ数チェックし警告 |
| 特殊フォント使用PDF | 文字化けの可能性 | ラスタライズ処理で回避 |

---

# 第2部：仕様書

## 1. システム構成

### 1.1 技術スタック

| 項目 | 選定技術 | 選定理由 |
|------|----------|----------|
| 言語 | Python 3.11+ | 無料、豊富なPDF処理ライブラリ、安定性 |
| GUIフレームワーク | tkinter + windnd | 標準ライブラリ、Windows専用軽量D&Dライブラリ |
| PDF処理 | PyMuPDF (fitz) | 高速、高品質レンダリング、商用利用可能 |
| 配布形式 | PyInstaller (.exe) | 単一実行ファイルで配布可能 |

### 1.2 ディレクトリ構成

```
pdf_to_png_converter/      # ソースコードパッケージ
├── main.py              # アプリケーションエントリーポイント
├── converter.py         # PDF→PNG変換ロジック
├── gui.py               # GUIコンポーネント (ttk + windnd)
├── config.py            # 設定値
└── requirements.txt     # 依存パッケージ

(ルートディレクトリ)
├── run.py               # PyInstaller用起動スクリプト
├── build.bat            # build用バッチファイル
└── start.bat            # 簡易起動用バッチファイル
```

---

## 2. 画面設計

### 2.1 メインウィンドウ

```
┌─────────────────────────────────────────────┐
│  PDF → PNG 変換ツール                    [×] │
├─────────────────────────────────────────────┤
│                                             │
│    ┌─────────────────────────────────┐      │
│    │                                 │      │
│    │   ここにPDFファイルを           │      │
│    │   ドラッグ＆ドロップ            │      │
│    │                                 │      │
│    │         📄                      │      │
│    │                                 │      │
│    └─────────────────────────────────┘      │
│                                             │
│  ステータス: 待機中                          │
│  ──────────────────────────────── 0%        │
│                                             │
│  出力先: C:\Users\[ユーザー名]\Pictures\PDF_PNG │
│                                             │
└─────────────────────────────────────────────┘
```

### 2.2 画面要素

| 要素 | 説明 |
|------|------|
| ドロップエリア | PDFファイルを受け付ける領域（破線枠） |
| ステータス表示 | 現在の処理状態を表示 |
| プログレスバー | 変換進捗をパーセンテージで表示 |
| 出力先表示 | 固定出力先フォルダのパスを表示 |

### 2.3 状態遷移

```
[待機中] → (ファイルドロップ) → [検証中] → [変換中] → [完了] → [待機中]
                                    ↓
                                [エラー] → [待機中]
```

---

## 3. 処理フロー

### 3.1 メインフロー

```
1. アプリケーション起動
2. ユーザーがPDFをドラッグ＆ドロップ
3. 入力検証
   3.1 ファイル形式チェック（.pdf）
   3.2 ファイル読み込み可否チェック
   3.3 ページ数チェック（≤30ページ）
   3.4 パスワード保護チェック
4. 変換処理開始
   4.1 各ページをPNG形式でレンダリング（200 DPI）
   4.2 ファイル保存（元ファイル名_001.png 形式）
   4.3 進捗更新
5. 完了通知表示
6. 待機状態に戻る
```

### 3.2 エラーハンドリング

| エラー種別 | 検出タイミング | 表示メッセージ例 |
|------------|----------------|------------------|
| 非PDFファイル | 入力検証時 | 「PDFファイルのみ対応しています。選択されたファイル: [ファイル名]」 |
| ファイル読み込み失敗 | 入力検証時 | 「ファイルを開けません。ファイルが破損しているか、アクセス権限がない可能性があります。」 |
| パスワード保護 | 入力検証時 | 「パスワードで保護されたPDFには対応していません。」 |
| ページ数超過 | 入力検証時 | 「30ページを超えるPDFには対応していません。このPDFは[N]ページあります。」 |
| 変換エラー | 変換処理中 | 「ページ[N]の変換中にエラーが発生しました: [詳細]」 |
| 保存エラー | ファイル保存時 | 「ファイルの保存に失敗しました。出力先フォルダへの書き込み権限を確認してください。」 |

---

## 4. 詳細仕様

### 4.1 画質設定

| パラメータ | 値 | 説明 |
|------------|-----|------|
| 解像度 | 200 DPI | 1080p動画（1920×1080）での使用に最適 |
| カラーモード | RGB | フルカラー出力 |
| 出力形式 | PNG | 可逆圧縮、透過対応 |

**補足**: A4サイズ（210mm×297mm）を200 DPIで変換すると約1654×2339ピクセルとなり、1080p動画でスライドとして表示する際に十分な解像度となる。

### 4.2 ファイル命名規則

```
入力: レポート2024.pdf（5ページ）
出力: 
  - レポート2024_001.png
  - レポート2024_002.png
  - レポート2024_003.png
  - レポート2024_004.png
  - レポート2024_005.png
```

- ページ番号は3桁ゼロ埋め（001〜999対応）
- ファイル名に使用できない文字は「_」に置換

### 4.3 出力先フォルダ

```
デフォルト: C:\Users\[ユーザー名]\Pictures\PDF_PNG\
```

- アプリ初回起動時に自動作成
- フォルダが存在しない場合は自動再作成

---

## 5. 開発・配布

### 5.1 依存パッケージ

```
PyMuPDF>=1.23.0
windnd>=1.0.3
pyinstaller>=6.0.0  # 開発時のみ
```

### 5.2 exe生成コマンド

```bash
pyinstaller --onefile --windowed --name "PDF_to_PNG" run.py
```

### 5.3 配布物

```
PDF_to_PNG.exe  # 単一実行ファイル（約30MB）
README.txt      # 簡易説明書
```

---

## 6. テスト項目

### 6.1 機能テスト

| テストID | テスト内容 | 期待結果 |
|----------|------------|----------|
| T-001 | 正常なPDF（10ページ）をドロップ | 10枚のPNG画像が生成される |
| T-002 | 30ページのPDFをドロップ | 30枚のPNG画像が生成される |
| T-003 | 31ページのPDFをドロップ | エラーメッセージが表示される |
| T-004 | JPGファイルをドロップ | エラーメッセージが表示される |
| T-005 | 破損したPDFをドロップ | エラーメッセージが表示される |
| T-006 | パスワード付きPDFをドロップ | エラーメッセージが表示される |
| T-007 | 日本語ファイル名のPDFをドロップ | 正常に変換・保存される |

### 6.2 品質テスト

| テストID | テスト内容 | 期待結果 |
|----------|------------|----------|
| Q-001 | 出力画像を1080p動画に配置 | 文字・図表が鮮明に表示される |
| Q-002 | 画像の多いPDFを変換 | 画像の劣化が目立たない |

---

## 7. 今後の拡張可能性（参考）

以下は現バージョンでは実装しないが、将来的に追加可能な機能：

- DPI設定の変更機能
- 出力先フォルダの変更機能
- 特定ページのみ変換
- 複数PDFの一括処理
- JPEG出力対応

---

## 改訂履歴

| バージョン | 日付 | 内容 |
|------------|------|------|
| 1.0 | 2025-12-10 | 初版作成 |
